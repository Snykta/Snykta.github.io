$(function(){var e,t,r,i=window.innerWidth,n=window.innerHeight,o=0,a=0,s=window.innerWidth/2,l=window.innerHeight/2;(c=document.createElement("div")).style.position="fixed",c.style.top="0px",c.style.left="0px",c.style.zIndex="-1",c.style.opacity="0.5",document.body.appendChild(c),(e=new THREE.PerspectiveCamera(75,i/n,1,1e4)).position.z=1e3,t=new THREE.Scene,(r=new THREE.CanvasRenderer).setClearColor(16119801,0),r.setPixelRatio(window.devicePixelRatio),r.setSize(i,n),c.appendChild(r.domElement);for(var c,p,d=2*Math.PI,E=new THREE.SpriteCanvasMaterial({color:10263708,program:function(e){e.beginPath(),e.arc(0,0,.5,0,d,!0),e.fill()}}),h=0;h<1e3;h++)(p=new THREE.Sprite(E)).position.x=2*Math.random()-1,p.position.y=2*Math.random()-1,p.position.z=2*Math.random()-1,p.position.normalize(),p.position.multiplyScalar(10*Math.random()+450),p.scale.multiplyScalar(2),t.add(p);for(h=0;h<300;h++){var m=new THREE.Geometry,f=new THREE.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),f=(f.normalize(),f.multiplyScalar(450),m.vertices.push(f),f.clone()),f=(f.multiplyScalar(.3*Math.random()+1),m.vertices.push(f),new THREE.Line(m,new THREE.LineBasicMaterial({color:10263708,opacity:Math.random()})));t.add(f)}function u(){s=window.innerWidth/2,l=window.innerHeight/2,e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight)}function v(e){o=e.clientX-s,a=e.clientY-l}function R(e){1<e.touches.length&&(o=e.touches[0].pageX-s)}function x(e){1==e.touches.length&&(o=e.touches[0].pageX-s)}function y(){e.position.x+=.05*(o-e.position.x),e.position.y+=.05*(200-a-e.position.y),e.lookAt(t.position),r.render(t,e)}document.addEventListener("mousemove",v,!1),document.addEventListener("touchstart",R,!1),document.addEventListener("touchmove",x,!1),window.addEventListener("resize",u,!1),function e(){requestAnimationFrame(e);y()}()}),THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var ne,oe,n,ae,se,le,ce,pe,de,Ee,he,me=[],fe=0,ue=[],t=0,r=[],i=0,o=[],a=0,ve=[],Re=0,xe={objects:[],lights:[],elements:[]},ye=new THREE.Vector3,Te=new THREE.Vector4,f=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),u=new THREE.Box3,s=new Array(3),we=(new Array(4),new THREE.Matrix4),He=new THREE.Matrix4,ge=new THREE.Matrix4,Se=new THREE.Matrix3,Me=new THREE.Frustum,Ce=new THREE.Vector4,be=new THREE.Vector4,ze=(this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")},new function(){var l=[],c=[],p=null,d=null,E=new THREE.Matrix3;function i(e){var t=e.position,r=e.positionWorld,i=e.positionScreen,t=(r.copy(t).applyMatrix4(he),i.copy(r).applyMatrix4(He),1/i.w);i.x*=t,i.y*=t,i.z*=t,e.visible=-1<=i.x&&i.x<=1&&-1<=i.y&&i.y<=1&&-1<=i.z&&i.z<=1}function h(e,t,r){return!0===e.visible||!0===t.visible||!0===r.visible||(s[0]=e.positionScreen,s[1]=t.positionScreen,s[2]=r.positionScreen,f.intersectsBox(u.setFromPoints(s)))}function m(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){d=(p=e).material,E.getNormalMatrix(p.matrixWorld),l.length=0,c.length=0},projectVertex:i,checkTriangleVisibility:h,checkBackfaceCulling:m,pushVertex:function(e,t,r){(n=Ve()).position.set(e,t,r),i(n)},pushNormal:function(e,t,r){l.push(e,t,r)},pushUv:function(e,t){c.push(e,t)},pushLine:function(e,t){e=ue[e],t=ue[t],(ce=Le()).id=p.id,ce.v1.copy(e),ce.v2.copy(t),ce.z=(e.positionScreen.z+t.positionScreen.z)/2,ce.renderOrder=p.renderOrder,ce.material=p.material,xe.elements.push(ce)},pushTriangle:function(e,t,r){var i=ue[e],n=ue[t],o=ue[r];if(!1!==h(i,n,o)&&(d.side===THREE.DoubleSide||!0===m(i,n,o))){(se=je()).id=p.id,se.v1.copy(i),se.v2.copy(n),se.v3.copy(o),se.z=(i.positionScreen.z+n.positionScreen.z+o.positionScreen.z)/3,se.renderOrder=p.renderOrder,se.normalModel.fromArray(l,3*e),se.normalModel.applyMatrix3(E).normalize();for(var a=0;a<3;a++){var s=se.vertexNormalsModel[a];s.fromArray(l,3*arguments[a]),s.applyMatrix3(E).normalize(),se.uvs[a].fromArray(c,2*arguments[a])}se.vertexNormalsLength=3,se.material=p.material,xe.elements.push(se)}}}});function Ve(){var e;return ae===t?(e=new THREE.RenderableVertex,ue.push(e),t++,ae++,e):ue[ae++]}function je(){var e;return le===i?(e=new THREE.RenderableFace,r.push(e),i++,le++,e):r[le++]}function Le(){var e;return pe===a?(e=new THREE.RenderableLine,o.push(e),a++,pe++,e):o[pe++]}function Oe(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,t,P,k){function N(e){(ne=function(){if(oe!==fe)return me[oe++];var e=new THREE.RenderableObject;return me.push(e),fe++,oe++,e}()).id=e.id,ne.object=e,ye.setFromMatrixPosition(e.matrixWorld),ye.applyMatrix4(He),ne.z=ye.z,ne.renderOrder=e.renderOrder,xe.objects.push(ne)}Ee=pe=le=0,!(xe.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),we.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),He.multiplyMatrices(t.projectionMatrix,we),Me.setFromMatrix(He),oe=0,xe.objects.length=0,xe.lights.length=0,e.traverseVisible(function(e){e instanceof THREE.Light?xe.lights.push(e):e instanceof THREE.Mesh||e instanceof THREE.Line?!1===e.material.visible||!0===e.frustumCulled&&!1===Me.intersectsObject(e)||N(e):e instanceof THREE.Sprite&&(!1===e.material.visible||!0===e.frustumCulled&&!1===Me.intersectsSprite(e)||N(e))}),!0===P&&xe.objects.sort(Oe);for(var r,i,n,o,a,s,l,c,p=0,F=xe.objects.length;p<F;p++){var d,E=xe.objects[p].object,h=E.geometry;if(ze.setObject(E),he=E.matrixWorld,ae=0,E instanceof THREE.Mesh){if(h instanceof THREE.BufferGeometry){var m=h.attributes,A=h.groups;if(void 0!==m.position){for(var f=0,u=(W=m.position.array).length;f<u;f+=3)ze.pushVertex(W[f],W[f+1],W[f+2]);if(void 0!==m.normal)for(var v=m.normal.array,f=0,u=v.length;f<u;f+=3)ze.pushNormal(v[f],v[f+1],v[f+2]);if(void 0!==m.uv)for(var I=m.uv.array,f=0,u=I.length;f<u;f+=2)ze.pushUv(I[f],I[f+1]);if(null!==h.index){var R=h.index.array;if(0<A.length)for(var D=0;D<A.length;D++)for(var G=A[D],f=G.start,u=G.start+G.count;f<u;f+=3)ze.pushTriangle(R[f],R[f+1],R[f+2]);else for(f=0,u=R.length;f<u;f+=3)ze.pushTriangle(R[f],R[f+1],R[f+2])}else for(f=0,u=W.length/3;f<u;f+=3)ze.pushTriangle(f,f+1,f+2)}}else if(h instanceof THREE.Geometry){var x=h.vertices,U=h.faces,q=h.faceVertexUvs[0];Se.getNormalMatrix(he);for(var X=(C=E.material)instanceof THREE.MultiMaterial,J=!0==X?E.material:null,y=0,Y=x.length;y<Y;y++){var T=x[y];if(ye.copy(T),!0===C.morphTargets)for(var $=h.morphTargets,K=E.morphTargetInfluences,w=0,Q=$.length;w<Q;w++){var H,g=K[w];0!==g&&(H=$[w].vertices[y],ye.x+=(H.x-T.x)*g,ye.y+=(H.y-T.y)*g,ye.z+=(H.z-T.z)*g)}ze.pushVertex(ye.x,ye.y,ye.z)}for(var S=0,Z=U.length;S<Z;S++){var M=U[S],C=!0==X?J.materials[M.materialIndex]:E.material;if(void 0!==C){var b=C.side,z=ue[M.a],V=ue[M.b],j=ue[M.c];if(!1!==ze.checkTriangleVisibility(z,V,j)){var L=ze.checkBackfaceCulling(z,V,j);if(b!==THREE.DoubleSide){if(b===THREE.FrontSide&&!1===L)continue;if(b===THREE.BackSide&&!0===L)continue}(se=je()).id=E.id,se.v1.copy(z),se.v2.copy(V),se.v3.copy(j),se.normalModel.copy(M.normal),!1!==L||b!==THREE.BackSide&&b!==THREE.DoubleSide||se.normalModel.negate(),se.normalModel.applyMatrix3(Se).normalize();for(var _=M.vertexNormals,O=0,ee=Math.min(_.length,3);O<ee;O++){var te=se.vertexNormalsModel[O];te.copy(_[O]),!1!==L||b!==THREE.BackSide&&b!==THREE.DoubleSide||te.negate(),te.applyMatrix3(Se).normalize()}se.vertexNormalsLength=_.length;var re=q[S];if(void 0!==re)for(var B=0;B<3;B++)se.uvs[B].copy(re[B]);se.color=M.color,se.material=C,se.z=(z.positionScreen.z+V.positionScreen.z+j.positionScreen.z)/3,se.renderOrder=E.renderOrder,xe.elements.push(se)}}}}}else if(E instanceof THREE.Line){if(h instanceof THREE.BufferGeometry){if(void 0!==(m=h.attributes).position){for(var W,f=0,u=(W=m.position.array).length;f<u;f+=3)ze.pushVertex(W[f],W[f+1],W[f+2]);if(null!==h.index)for(f=0,u=(R=h.index.array).length;f<u;f+=2)ze.pushLine(R[f],R[f+1]);else for(var ie=E instanceof THREE.LineSegments?2:1,f=0,u=W.length/3-1;f<u;f+=ie)ze.pushLine(f,f+1)}}else if(h instanceof THREE.Geometry){ge.multiplyMatrices(He,he);x=E.geometry.vertices;if(0!==x.length){(z=Ve()).positionScreen.copy(x[0]).applyMatrix4(ge);for(ie=E instanceof THREE.LineSegments?2:1,y=1,Y=x.length;y<Y;y++)(z=Ve()).positionScreen.copy(x[y]).applyMatrix4(ge),0<(y+1)%ie||(V=ue[ae-2],Ce.copy(z.positionScreen),be.copy(V.positionScreen),!0==(i=be,c=l=s=a=o=n=void 0,n=0,o=1,a=(r=Ce).z+r.w,s=i.z+i.w,l=-r.z+r.w,c=-i.z+i.w,0<=a&&0<=s&&0<=l&&0<=c||!(a<0&&s<0||l<0&&c<0)&&(a<0?n=Math.max(n,a/(a-s)):s<0&&(o=Math.min(o,a/(a-s))),l<0?n=Math.max(n,l/(l-c)):c<0&&(o=Math.min(o,l/(l-c))),!(o<n)&&(r.lerp(i,n),i.lerp(r,1-o),!0)))&&(Ce.multiplyScalar(1/Ce.w),be.multiplyScalar(1/be.w),(ce=Le()).id=E.id,ce.v1.positionScreen.copy(Ce),ce.v2.positionScreen.copy(be),ce.z=Math.max(Ce.z,be.z),ce.renderOrder=E.renderOrder,ce.material=E.material,E.material.vertexColors===THREE.VertexColors&&(ce.vertexColors[0].copy(E.geometry.colors[y]),ce.vertexColors[1].copy(E.geometry.colors[y-1])),xe.elements.push(ce)))}}}else E instanceof THREE.Sprite&&(Te.set(he.elements[12],he.elements[13],he.elements[14],1),Te.applyMatrix4(He),d=1/Te.w,Te.z*=d,-1<=Te.z&&Te.z<=1&&((de=function(){if(Ee!==Re)return ve[Ee++];var e=new THREE.RenderableSprite;return ve.push(e),Re++,Ee++,e}()).id=E.id,de.x=Te.x*d,de.y=Te.y*d,de.z=Te.z,de.renderOrder=E.renderOrder,de.object=E,de.rotation=E.rotation,de.scale.x=E.scale.x*Math.abs(de.x-(Te.x+t.projectionMatrix.elements[0])/(Te.w+t.projectionMatrix.elements[12])),de.scale.y=E.scale.y*Math.abs(de.y-(Te.y+t.projectionMatrix.elements[5])/(Te.w+t.projectionMatrix.elements[13])),de.material=E.material,xe.elements.push(de)))}return!0===k&&xe.elements.sort(Oe),xe}},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var k,N,F,A,I,D,G,U,q,X,J,Y,Ee,he,me,fe,ue,$=this,ve=new THREE.Projector,i=void 0!==e.canvas?e.canvas:document.createElement("canvas"),K=i.width,Q=i.height,Z=Math.floor(K/2),_=Math.floor(Q/2),Re=0,xe=0,ye=K,Te=Q,n=1,ee=i.getContext("2d",{alpha:!0===e.alpha}),r=new THREE.Color(0),o=!0===e.alpha?0:1,a=1,s=0,l=null,c=null,p=null,d=null,E=null,t=[],te=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),we=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),He=new THREE.Color,ge=new THREE.Color,re={},ie=new THREE.Box2,ne=new THREE.Box2,oe=new THREE.Box2,Se=new THREE.Color,Me=new THREE.Color,Ce=new THREE.Color,be=new THREE.Vector3,ze=new THREE.Vector3,ae=new THREE.Vector3,se=new THREE.Matrix3;function Ve(e,t,r,i){We(t),Pe(r),ke(i),pe(e.getStyle()),ee.stroke(),oe.expandByScalar(2*t)}function je(e){de(e.getStyle()),ee.fill()}function Le(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image;if(!1===t.complete)return{canvas:void 0,version:0};var r=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,i=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,n=e.wrapS===THREE.MirroredRepeatWrapping,o=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas"),s=(a.width=t.width*(n?2:1),a.height=t.height*(o?2:1),a.getContext("2d")),n=(s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),!0==n&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),!0==o&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),!0==n&&!0==o&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height)),"no-repeat"),o=(!0==r&&!0==i?n="repeat":!0==r?n="repeat-x":!0==i&&(n="repeat-y"),ee.createPattern(a,n));return e.onUpdate&&e.onUpdate(e),{canvas:o,version:e.version}}function Oe(e,t,r,i,n,o,a,s,l,c,p,d,E){var h=re[E.id];if(void 0!==h&&h.version===E.version||(h=Le(E),re[E.id]=h),void 0===h.canvas)return de("rgba( 0, 0, 0, 1)"),void ee.fill();de(h.canvas);var h=E.offset.x/E.repeat.x,m=E.offset.y/E.repeat.y,f=E.image.width*E.repeat.x,E=E.image.height*E.repeat.y;l=(l+h)*f,c=(c+m)*E,p=(p+h)*f,d=(d+m)*E,r-=e,i-=t,n-=e,o-=t,0!=(h=(l-=a=(a+h)*f)*(d-=s=(s+m)*E)-(p-=a)*(c-=s))&&(e=e-(m=(d*r-c*n)*(f=1/h))*a-(E=(l*n-p*r)*f)*s,r=t-(h=(d*i-c*o)*f)*a-(n=(l*o-p*i)*f)*s,ee.save(),ee.transform(m,h,E,n,e,r),ee.fill(),ee.restore())}function Be(e,t,r){var i=t.x-e.x,n=t.y-e.y,o=i*i+n*n;0!=o&&(n*=r=r/Math.sqrt(o),t.x+=i*=r,t.y+=n,e.x-=i,e.y-=n)}function le(e){a!==e&&(ee.globalAlpha=e,a=e)}function ce(e){s!==e&&(e===THREE.NormalBlending?ee.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?ee.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?ee.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(ee.globalCompositeOperation="multiply"),s=e)}function We(e){p!==e&&(ee.lineWidth=e,p=e)}function Pe(e){d!==e&&(ee.lineCap=e,d=e)}function ke(e){E!==e&&(ee.lineJoin=e,E=e)}function pe(e){l!==e&&(ee.strokeStyle=e,l=e)}function de(e){c!==e&&(ee.fillStyle=e,c=e)}function Ne(e){t.length!==e.length&&(ee.setLineDash(e),t=e)}void 0===ee.setLineDash&&(ee.setLineDash=function(){}),this.domElement=i,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return ee},this.getContextAttributes=function(){return ee.getContextAttributes()},this.getPixelRatio=function(){return n},this.setPixelRatio=function(e){void 0!==e&&(n=e)},this.setSize=function(e,t,r){K=e*n,Q=t*n,i.width=K,i.height=Q,Z=Math.floor(K/2),_=Math.floor(Q/2),!1!==r&&(i.style.width=e+"px",i.style.height=t+"px"),ie.min.set(-Z,-_),ie.max.set(Z,_),ne.min.set(-Z,-_),ne.max.set(Z,_),a=1,s=0,E=d=p=c=l=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){Re=e*n,xe=t*n,ye=r*n,Te=i*n},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){r.set(e),o=void 0!==t?t:1,ne.min.set(-Z,-_),ne.max.set(Z,_)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return r},this.getClearAlpha=function(){return o},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===ne.isEmpty()&&(ne.intersect(ie),ne.expandByScalar(2),ne.min.x=ne.min.x+Z,ne.min.y=-ne.min.y+_,ne.max.x=ne.max.x+Z,ne.max.y=-ne.max.y+_,o<1&&ee.clearRect(0|ne.min.x,0|ne.max.y,ne.max.x-ne.min.x|0,ne.min.y-ne.max.y|0),0<o&&(ce(THREE.NormalBlending),le(1),de("rgba("+Math.floor(255*r.r)+","+Math.floor(255*r.g)+","+Math.floor(255*r.b)+","+o+")"),ee.fillRect(0|ne.min.x,0|ne.max.y,ne.max.x-ne.min.x|0,ne.min.y-ne.max.y|0)),ne.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof THREE.Camera==!1)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{var r=e.background;r&&r.isColor?(de("rgb("+Math.floor(255*r.r)+","+Math.floor(255*r.g)+","+Math.floor(255*r.b)+")"),ee.fillRect(0,0,K,Q)):!0===this.autoClear&&this.clear(),$.info.render.vertices=0,$.info.render.faces=0,ee.setTransform(ye/K,0,0,-Te/Q,Re,Q-xe),ee.translate(Z,_),k=ve.projectScene(e,t,this.sortObjects,this.sortElements),N=k.elements,F=k.lights,se.getNormalMatrix(t.matrixWorldInverse),Se.setRGB(0,0,0),Me.setRGB(0,0,0),Ce.setRGB(0,0,0);for(var i=0,n=F.length;i<n;i++){var o=F[i],a=o.color;o instanceof THREE.AmbientLight?Se.add(a):o instanceof THREE.DirectionalLight?Me.add(a):o instanceof THREE.PointLight&&Ce.add(a)}for(var s,l,c=0,P=N.length;c<P;c++){var p=N[c],d=p.material;if(void 0!==d&&0!==d.opacity){if(oe.makeEmpty(),p instanceof THREE.RenderableSprite){(A=p).x*=Z,A.y*=_,v=u=T=y=x=R=T=T=u=u=h=f=m=h=E=void 0;var E=A,h=p,m=d,f=(le(m.opacity),ce(m.blending),h.scale.x*Z),h=h.scale.y*_,u=.5*Math.sqrt(f*f+h*h);oe.min.set(E.x-u,E.y-u),oe.max.set(E.x+u,E.y+u),m instanceof THREE.SpriteMaterial?null!==(u=m.map)?(void 0!==(T=re[u.id])&&T.version===u.version||(T=Le(u),re[u.id]=T),void 0!==T.canvas&&(de(T.canvas),T=u.image,R=T.width*u.offset.x,x=T.height*u.offset.y,y=T.width*u.repeat.x,T=T.height*u.repeat.y,u=f/y,v=h/T,ee.save(),ee.translate(E.x,E.y),0!==m.rotation&&ee.rotate(m.rotation),ee.translate(-f/2,-h/2),ee.scale(u,v),ee.translate(-R,-x),ee.fillRect(R,x,y,T),ee.restore())):(de(m.color.getStyle()),ee.save(),ee.translate(E.x,E.y),0!==m.rotation&&ee.rotate(m.rotation),ee.scale(f,-h),ee.fillRect(-.5,-.5,1,1),ee.restore()):m instanceof THREE.SpriteCanvasMaterial&&(pe(m.color.getStyle()),de(m.color.getStyle()),ee.save(),ee.translate(E.x,E.y),0!==m.rotation&&ee.rotate(m.rotation),ee.scale(f,h),m.program(ee),ee.restore())}else if(p instanceof THREE.RenderableLine){if(A=p.v1,I=p.v2,A.positionScreen.x*=Z,A.positionScreen.y*=_,I.positionScreen.x*=Z,I.positionScreen.y*=_,oe.setFromPoints([A.positionScreen,I.positionScreen]),!0===ie.intersectsBox(oe)){T=R=y=x=R=v=u=void 0;var u=A,v=I,R=p,x=d;if(le(x.opacity),ce(x.blending),ee.beginPath(),ee.moveTo(u.positionScreen.x,u.positionScreen.y),ee.lineTo(v.positionScreen.x,v.positionScreen.y),x instanceof THREE.LineBasicMaterial){if(We(x.linewidth),Pe(x.linecap),ke(x.linejoin),x.vertexColors!==THREE.VertexColors)pe(x.color.getStyle());else{var y=R.vertexColors[0].getStyle(),R=R.vertexColors[1].getStyle();if(y===R)pe(y);else{try{var T=ee.createLinearGradient(u.positionScreen.x,u.positionScreen.y,v.positionScreen.x,v.positionScreen.y);T.addColorStop(0,y),T.addColorStop(1,R)}catch(e){T=y}pe(T)}}ee.stroke(),oe.expandByScalar(2*x.linewidth)}else x instanceof THREE.LineDashedMaterial&&(We(x.linewidth),Pe(x.linecap),ke(x.linejoin),pe(x.color.getStyle()),Ne([x.dashSize,x.gapSize]),ee.stroke(),oe.expandByScalar(2*x.linewidth),Ne([]))}}else if(p instanceof THREE.RenderableFace){if(A=p.v1,I=p.v2,D=p.v3,A.positionScreen.z<-1||1<A.positionScreen.z)continue;if(I.positionScreen.z<-1||1<I.positionScreen.z)continue;if(D.positionScreen.z<-1||1<D.positionScreen.z)continue;if(A.positionScreen.x*=Z,A.positionScreen.y*=_,I.positionScreen.x*=Z,I.positionScreen.y*=_,D.positionScreen.x*=Z,D.positionScreen.y*=_,0<d.overdraw&&(Be(A.positionScreen,I.positionScreen,d.overdraw),Be(I.positionScreen,D.positionScreen,d.overdraw),Be(D.positionScreen,A.positionScreen,d.overdraw)),oe.setFromPoints([A.positionScreen,I.positionScreen,D.positionScreen]),!0===ie.intersectsBox(oe)){E=A,f=I,h=D,m=0,s=1,l=2,p=p,d=d,$.info.render.vertices+=3,$.info.render.faces++,le(d.opacity),ce(d.blending),D=E.positionScreen.x,G=E.positionScreen.y,U=f.positionScreen.x,q=f.positionScreen.y,X=h.positionScreen.x,J=h.positionScreen.y,C=M=S=g=H=w=void 0;var w=D,H=G,g=U,S=q,M=X,C=J;if(ee.beginPath(),ee.moveTo(w,H),ee.lineTo(g,S),ee.lineTo(M,C),ee.closePath(),(d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial)&&null===d.map){we.copy(d.color),He.copy(d.emissive),d.vertexColors===THREE.FaceColors&&we.multiply(p.color),te.copy(Se),ze.copy(E.positionWorld).add(f.positionWorld).add(h.positionWorld).divideScalar(3);{b=void 0;z=void 0;V=void 0;j=void 0;L=void 0;W=void 0;O=void 0;B=void 0;var b=ze;var z=p.normalModel;var V=te;for(var j=0,L=F.length;j<L;j++){var O,B,W=F[j];ge.copy(W.color),W instanceof THREE.DirectionalLight?(O=be.setFromMatrixPosition(W.matrixWorld).normalize(),(B=z.dot(O))<=0||(B*=W.intensity,V.add(ge.multiplyScalar(B)))):W instanceof THREE.PointLight&&(O=be.setFromMatrixPosition(W.matrixWorld),(B=z.dot(be.subVectors(O,b).normalize()))<=0||0!=(B*=0==W.distance?1:1-Math.min(b.distanceTo(O)/W.distance,1))&&(B*=W.intensity,V.add(ge.multiplyScalar(B))))}}te.multiply(we).add(He),!0===d.wireframe?Ve(te,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):je(te)}else d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial?null!==d.map?d.map.mapping===THREE.UVMapping&&(Y=p.uvs,Oe(D,G,U,q,X,J,Y[m].x,Y[m].y,Y[s].x,Y[s].y,Y[l].x,Y[l].y,d.map)):null!==d.envMap?d.envMap.mapping===THREE.SphericalReflectionMapping&&(ae.copy(p.vertexNormalsModel[m]).applyMatrix3(se),Y=.5*ae.x+.5,Ee=.5*ae.y+.5,ae.copy(p.vertexNormalsModel[s]).applyMatrix3(se),he=.5*ae.x+.5,me=.5*ae.y+.5,ae.copy(p.vertexNormalsModel[l]).applyMatrix3(se),fe=.5*ae.x+.5,ue=.5*ae.y+.5,Oe(D,G,U,q,X,J,Y,Ee,he,me,fe,ue,d.envMap)):(te.copy(d.color),d.vertexColors===THREE.FaceColors&&te.multiply(p.color),!0===d.wireframe?Ve(te,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):je(te)):(d instanceof THREE.MeshNormalMaterial?(ae.copy(p.normalModel).applyMatrix3(se),te.setRGB(ae.x,ae.y,ae.z).multiplyScalar(.5).addScalar(.5)):te.setRGB(1,1,1),!0===d.wireframe?Ve(te,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):je(te))}}ne.union(oe)}}ee.setTransform(1,0,0,1,0,0)}}};